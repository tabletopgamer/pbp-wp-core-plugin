<?php 
namespace PbP_WP\Implementations;

use PbP_Core\Interfaces\IEntity_Repository;
use PbP_WP\Interfaces\IEntity_Adapter_Factory;


/**
 * @package wordpress-specific
 *  
 * Wordpress specific implementation for an IEntityRepository
 * @see Entity_Repository_Interface
 */
class Custom_Post_Entity_Repository implements IEntity_Repository{

    /**
     * @var IEntity_Adapter_Factory
     */
    private $entityAdapterFactory;
    /**
     * @var
     */
    private $entity_adapter_factory;

	/**
     * @param IEntity_Adapter_Factory $entity_adapter_factory
     */
    public function __construct(IEntity_Adapter_Factory $entity_adapter_factory){

        $this->entity_adapter_factory = $entity_adapter_factory;
    }

    /**
     * @param array[int] $entityIds
     * @return array[IEntity] An array containing all entities for the specified ids. 
     * If no entities could be found, then an emtpy array is returned.
     */
    public function getByIds( array $entityIds ) {
        
        $args = array( 'post__in' => $entityIds );
          
        $wpPosts = \get_posts( $args );
        
        $entities = array();
        
        if ( count( $wpPosts ) > 0 ){
            foreach ( $wpPosts as $wpPost ){
                $entities[] = $this->entity_adapter_factory->get_entity_adapter($wpPost) ;
               
            }
        }
        
        return $entities;
    }

    /**
     * @param int $entityId
     * @return Entity_Interface The IEntity, if there is an entity with entity_id exists, NULL otherwise
     */
<<<<<<< HEAD:pbp-wp/implementations/class-custom-post-entity-repository.php
    public function getById( $entityId ) {
=======
    public function getEntityById( $entityId ) {
>>>>>>> 1811156... unit test mingling:pbp-wp/implementations/class-pbp-wp-post-entity-repository.php
		
		if (!is_numeric( $entityId )){
			throw new \InvalidArgumentException("entityId must be null");
		}
		
        $result = NULL;
        $wpPost = \get_post( $entityId );
        
        if ( $wpPost !== NULL ){
            $result = new Custom_Post_Entity_Adapter( $wpPost );
        }
        
        return $result;
    }

}
